# Generated by Django 2.0.6 on 2018-09-22 09:08

from django.db import migrations

from django.utils.text import slugify

def gen_slug(apps, schema_editor):
    MyModel = apps.get_model('blog','Tag')
    for row in MyModel.objects.all():
        if row.slug == '1':
            orig = slug = slugify(row.name)
            if MyModel.objects.filter(slug=slug).exists():
                for x in itertools.count(1):
                    if not Tag.objects.filter(slug=slug).exists():
                        break
                    slug = '%s-%d' % (orig, x)
            row.slug = slug
        row.save()
        print (row.slug)

class Migration(migrations.Migration):

    dependencies = [
        ('blog', '0002_tag_slug'),
    ]

    operations = [
        migrations.RunPython(gen_slug)
    ]
