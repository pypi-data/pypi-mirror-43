

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Examples &mdash; gdspy 1.3.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Geometry Construction" href="geometry.html" />
    <link rel="prev" title="gdspy’s Documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> gdspy
          

          
          </a>

          
            
            
              <div class="version">
                1.3.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tutorial">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="#integrated-photonics">Integrated Photonics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="geometry.html">Geometry Construction</a></li>
<li class="toctree-l1"><a class="reference internal" href="library.html">GDSII Library</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">gdspy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="tutorial">
<h2>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h2>
<p>The following code is a sample to quickly demonstrate some features of gdspy.</p>
<p><a class="reference download internal" download="" href="_downloads/df623f3f233fae4c8953bfbdf0e02230/tutorial.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">sample</span> <span class="pre">file</span></code></a></p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">######################################################################</span>
<span class="c1">#                                                                    #</span>
<span class="c1">#  Copyright 2009-2018 Lucas Heitzmann Gabrielli.                    #</span>
<span class="c1">#  This file is part of gdspy, distributed under the terms of the    #</span>
<span class="c1">#  Boost Software License - Version 1.0.  See the accompanying       #</span>
<span class="c1">#  LICENSE file or &lt;http://www.boost.org/LICENSE_1_0.txt&gt;            #</span>
<span class="c1">#                                                                    #</span>
<span class="c1">######################################################################</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">gdspy</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Using gdspy module version &#39;</span> <span class="o">+</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>

<span class="c1"># ------------------------------------------------------------------ #</span>
<span class="c1">#      POLYGONS</span>
<span class="c1"># ------------------------------------------------------------------ #</span>

<span class="c1"># First we need a cell to add the polygons to.</span>
<span class="n">poly_cell</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="s1">&#39;POLYGONS&#39;</span><span class="p">)</span>

<span class="c1"># We define the polygon through its vertices.</span>
<span class="n">points</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>

<span class="c1"># Create the polygon on layer 1.</span>
<span class="n">poly1</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Add the new polygon to the cell.</span>
<span class="n">poly_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">poly1</span><span class="p">)</span>

<span class="c1"># Create another polygon from the same set of points, but rotate it</span>
<span class="c1"># 180 degrees and add it to the cell.</span>
<span class="n">poly2</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">poly_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">poly2</span><span class="p">)</span>

<span class="c1"># To create rectangles we don&#39;t need to give the 4 corners, only 2.</span>
<span class="c1"># Note that we don&#39;t need to create a variable if we are not going to</span>
<span class="c1"># use it, just add the rectangle directly to the cell.  Create a</span>
<span class="c1"># rectangle in layer 2.</span>
<span class="n">poly_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gdspy</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">18</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># There are no circles in the GDSII specification, so rounded shapes</span>
<span class="c1"># are actually many-sided polygons.  Create a circle in layer 2,</span>
<span class="c1"># centered at (27, 2), and with radius 2.</span>
<span class="n">poly_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gdspy</span><span class="o">.</span><span class="n">Round</span><span class="p">((</span><span class="mi">27</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># The Round class is quite versatile: it provides circles, pie slices,</span>
<span class="c1"># rings and ring sections, like this one in layer 2.</span>
<span class="n">poly_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">gdspy</span><span class="o">.</span><span class="n">Round</span><span class="p">(</span>
        <span class="p">(</span><span class="mf">23.5</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
        <span class="mi">15</span><span class="p">,</span>
        <span class="n">inner_radius</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
        <span class="n">initial_angle</span><span class="o">=-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span>
        <span class="n">final_angle</span><span class="o">=-</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span>
        <span class="n">layer</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># ------------------------------------------------------------------ #</span>
<span class="c1">#      PATHS</span>
<span class="c1"># ------------------------------------------------------------------ #</span>

<span class="n">path_cell</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="s1">&#39;PATHS&#39;</span><span class="p">)</span>

<span class="c1"># Start a path from the origin with width 1.</span>
<span class="n">path1</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Add a straight segment to the path in layer 1, datatype 1, with length</span>
<span class="c1"># 3, going in the &#39;+x&#39; direction. Since we&#39;ll use this layer/datatype</span>
<span class="c1"># configuration again, we can setup a dict containing this info.</span>
<span class="n">spec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;layer&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;datatype&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">path1</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;+x&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span>

<span class="c1"># Add a curve to the path by specifying its radius as 2 and its initial</span>
<span class="c1"># and final angles.</span>
<span class="n">path1</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span>

<span class="c1"># Add another segment to the path in layer 1, with length 4 and</span>
<span class="c1"># pointing in the direction defined by the last piece we added above.</span>
<span class="n">path1</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span>

<span class="c1"># Add a curve using the turn command.  We specify the radius 2 and</span>
<span class="c1"># turning angle. The agnle can also be specified with &#39;l&#39; and &#39;r&#39; for</span>
<span class="c1"># left and right turns of 90 degrees, or &#39;ll&#39; and &#39;rr&#39; for 180 degrees.</span>
<span class="n">path1</span><span class="o">.</span><span class="n">turn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span>

<span class="c1"># Final piece of the path.  Add a straight segment and tapper the path</span>
<span class="c1"># width from the original 1 to 0.5.</span>
<span class="n">path1</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">final_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span>
<span class="n">path_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path1</span><span class="p">)</span>

<span class="c1"># We can also create parallel paths simultaneously.  Start 2 paths with</span>
<span class="c1"># width 0.5 each,nd pitch 1, originating where our last path ended.</span>
<span class="n">path2</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="n">path1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">path1</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="n">number_of_paths</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Add a straight segment to the paths gradually increasing their</span>
<span class="c1"># distance to 1.5, in the direction in which the last path ended.</span>
<span class="n">spec</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">path2</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">path1</span><span class="o">.</span><span class="n">direction</span><span class="p">,</span> <span class="n">final_distance</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span>

<span class="c1"># Path commands can be concatenated.  Add a turn and a tapper segment</span>
<span class="c1"># in one expression, followed by a final turn.</span>
<span class="n">path2</span><span class="o">.</span><span class="n">turn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
    <span class="mi">4</span><span class="p">,</span> <span class="n">final_distance</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span>
<span class="n">path2</span><span class="o">.</span><span class="n">turn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span>
<span class="n">path_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path2</span><span class="p">)</span>

<span class="c1"># Create another single path 0.5 wide, starting where the path above</span>
<span class="c1"># ended, and add to it a line segment in the 3rd layer in the &#39;-y&#39;</span>
<span class="c1"># direction.</span>
<span class="n">path3</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="n">path2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">path2</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
<span class="n">path3</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;-y&#39;</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>


<span class="c1"># We can create paths based on parametric curves. First we need to</span>
<span class="c1"># define the curve function, with 1 argument.  This argument will vary</span>
<span class="c1"># from 0 to 1 and the return value should be the (x, y) coordinates of</span>
<span class="c1"># the path.  This could be a lambda-expression if the function is</span>
<span class="c1"># simple enough.  We will create a spiral path.  Note that the function</span>
<span class="c1"># returns (0, 0) when t=0, so that our path is connected.</span>
<span class="k">def</span> <span class="nf">spiral</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">t</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">r</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>


<span class="c1"># We can also create the derivative of the curve to pass to out path</span>
<span class="c1"># path member, otherwise it will be numerically calculated.  In the</span>
<span class="c1"># spiral case we don&#39;t want the exact derivative, but the derivative of</span>
<span class="c1"># the spiral as if its radius was constant.  This will ensure that our</span>
<span class="c1"># path is connected at the start (geometric problem of this kind of</span>
<span class="c1"># spiral).</span>
<span class="k">def</span> <span class="nf">dspiral_dt</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">dx_dt</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">dy_dt</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">dx_dt</span><span class="p">,</span> <span class="n">dy_dt</span><span class="p">)</span>


<span class="c1"># Add the parametric spiral to the path in layer 3.  Note that we can</span>
<span class="c1"># still tapper the width (linearly or with a taper function).  To make</span>
<span class="c1"># the curve smoother, we increase the number of evaluations of the</span>
<span class="c1"># function (fracture will be performed automatically to ensure polygons</span>
<span class="c1"># with less than 200 points).</span>
<span class="n">path3</span><span class="o">.</span><span class="n">parametric</span><span class="p">(</span>
    <span class="n">spiral</span><span class="p">,</span>
    <span class="n">dspiral_dt</span><span class="p">,</span>
    <span class="n">final_width</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="mf">0.4</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">number_of_evaluations</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">path_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path3</span><span class="p">)</span>

<span class="c1"># Polygonal paths are defined by the points they pass through.  The</span>
<span class="c1"># width of the path can be given as a number, representing the path</span>
<span class="c1"># width along is whole extension, or as a list, where each element is</span>
<span class="c1"># the width of the path at one point.  Our path will have width 0.5 in</span>
<span class="c1"># all points, except the last, where it will tapper up to 1.5.  More</span>
<span class="c1"># than 1 path can be defined in parallel as well (useful for buses).</span>
<span class="c1"># The distance between the paths work the same way as the width: it&#39;s</span>
<span class="c1"># either a constant number, or a list.  We create 5 parallel paths that</span>
<span class="c1"># are larger and further apart on the last point. The paths are put in</span>
<span class="c1"># layers 4 and 5. Since we have 5 paths, the list of layers will be</span>
<span class="c1"># run more than once, so the 5 paths will actually be in layers 4, 5, 4,</span>
<span class="c1"># 5, and 4.</span>
<span class="n">points</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)]</span>
<span class="n">widths</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">]</span>
<span class="n">distances</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mf">2.4</span><span class="p">]</span>
<span class="n">polypath</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">PolyPath</span><span class="p">(</span>
    <span class="n">points</span><span class="p">,</span> <span class="n">widths</span><span class="p">,</span> <span class="n">number_of_paths</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distances</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>

<span class="c1"># We can round the corners of any Polygon or PolygonSet with the fillet</span>
<span class="c1"># method. Here we use a radius of 0.2.</span>
<span class="c1"># polypath.fillet(0.2)</span>
<span class="n">path_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">polypath</span><span class="p">)</span>

<span class="c1"># L1Paths use only segments in &#39;x&#39; and &#39;y&#39; directions, useful for some</span>
<span class="c1"># lithography mask writers.  We specify a path composed of 16 segments</span>
<span class="c1"># of length 4.  The turns after each segment can be either 90 degrees</span>
<span class="c1"># CCW (positive) or CW (negative).  The absolute value of the turns</span>
<span class="c1"># produces a scaling of the path width and distance between paths in</span>
<span class="c1"># segments immediately after the turn.</span>
<span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
<span class="n">turns</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
<span class="n">l1path</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">L1Path</span><span class="p">(</span>
    <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">11</span><span class="p">),</span>
    <span class="s1">&#39;+y&#39;</span><span class="p">,</span>
    <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">lengths</span><span class="p">,</span>
    <span class="n">turns</span><span class="p">,</span>
    <span class="n">number_of_paths</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">layer</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">path_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">l1path</span><span class="p">)</span>

<span class="c1"># ------------------------------------------------------------------ #</span>
<span class="c1">#      POLYGON OPERATIONS</span>
<span class="c1"># ------------------------------------------------------------------ #</span>

<span class="c1"># Boolean operations can be executed with either gdspy polygons or</span>
<span class="c1"># point lists).  The operations are union, intersection, subtraction,</span>
<span class="c1"># symmetric subtracion (respectively &#39;or&#39;, &#39;and&#39;, &#39;not&#39;, &#39;xor&#39;).</span>
<span class="n">oper_cell</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="s1">&#39;OPERATIONS&#39;</span><span class="p">)</span>

<span class="c1"># Here we subtract the previously created spiral from a rectangle with</span>
<span class="c1"># the &#39;not&#39; operation.</span>
<span class="n">oper_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">gdspy</span><span class="o">.</span><span class="n">fast_boolean</span><span class="p">(</span>
        <span class="n">gdspy</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> <span class="n">path3</span><span class="p">,</span> <span class="s1">&#39;not&#39;</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># Polygon offset (inset and outset) can be used, for instance, to</span>
<span class="c1"># define safety margins around shapes.</span>

<span class="n">spec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;layer&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}</span>
<span class="n">path4</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;+x&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">turn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span><span class="o">.</span><span class="n">turn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;rr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span>
<span class="n">oper_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path4</span><span class="p">)</span>

<span class="c1"># Merge all parts into a single polygon.</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">fast_boolean</span><span class="p">(</span><span class="n">path4</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">,</span> <span class="n">max_points</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Offset the path shape by 0.5 and add it to the cell.</span>
<span class="n">oper_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gdspy</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>

<span class="c1"># ------------------------------------------------------------------ #</span>
<span class="c1">#      SLICING POLYGONS</span>
<span class="c1"># ------------------------------------------------------------------ #</span>

<span class="c1"># If there is the need to cut a polygon or set of polygons, it&#39;s better</span>
<span class="c1"># to use the slice function than set up a boolean operation, since it</span>
<span class="c1"># runs much faster.  Slices are multiple cuts perpendicular to an axis.</span>
<span class="n">slice_cell</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="s1">&#39;SLICE&#39;</span><span class="p">)</span>
<span class="n">original</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Round</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">10</span><span class="p">,</span> <span class="n">inner_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Slice the original ring along x = -7 and x = 7.</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># The result is a tuple of polygon sets, one for each slice.  To keep</span>
<span class="c1"># add the region betwen our 2 cuts, we chose result[1].</span>
<span class="n">slice_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># If the cut needs to be at an angle we can rotate the geometry, slice</span>
<span class="c1"># it, and rotate back.</span>
<span class="n">original</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">PolyPath</span><span class="p">([(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">),</span>
                           <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">original</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">slice_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># ------------------------------------------------------------------ #</span>
<span class="c1">#      REFERENCES AND TEXT</span>
<span class="c1"># ------------------------------------------------------------------ #</span>

<span class="c1"># Cells can contain references to other cells.</span>
<span class="n">ref_cell</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="s1">&#39;REFS&#39;</span><span class="p">)</span>
<span class="n">ref_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gdspy</span><span class="o">.</span><span class="n">CellReference</span><span class="p">(</span><span class="n">poly_cell</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">x_reflection</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="n">ref_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gdspy</span><span class="o">.</span><span class="n">CellReference</span><span class="p">(</span><span class="n">poly_cell</span><span class="p">,</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">180</span><span class="p">))</span>

<span class="c1"># References can be whole arrays. Add an array of the operations cell</span>
<span class="c1"># with 2 lines and 3 columns and 1st element at (25, 10).</span>
<span class="n">ref_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">gdspy</span><span class="o">.</span><span class="n">CellArray</span><span class="p">(</span><span class="s1">&#39;OPERATIONS&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">magnification</span><span class="o">=</span><span class="mf">1.5</span><span class="p">))</span>

<span class="c1"># Text are also sets of polygons. They have edges parallel to &#39;x&#39; and</span>
<span class="c1"># &#39;y&#39; only.</span>
<span class="n">ref_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">gdspy</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
        <span class="s1">&#39;Created with gsdpy &#39;</span> <span class="o">+</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">35</span><span class="p">),</span> <span class="n">layer</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>

<span class="c1"># Labels are special text objects which don&#39;t define any actual</span>
<span class="c1"># geometry, but can be used to annotate the drawing.  Rotation,</span>
<span class="c1"># magnification and reflection of the text are not supported by the</span>
<span class="c1"># included GUI, but they are included in the resulting GDSII file.</span>
<span class="n">ref_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">gdspy</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
        <span class="s1">&#39;Created with gdspy &#39;</span> <span class="o">+</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">36</span><span class="p">),</span> <span class="s1">&#39;nw&#39;</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>

<span class="c1"># ------------------------------------------------------------------ #</span>
<span class="c1">#      Translation</span>
<span class="c1"># ------------------------------------------------------------------ #</span>

<span class="n">trans_cell</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="s1">&#39;TRANS&#39;</span><span class="p">)</span>

<span class="c1"># Any geometric object can be translated by providing the distance to</span>
<span class="c1"># translate in the x-direction and y-direction:  translate(dx, dy)</span>
<span class="n">rect1</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">80</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">81</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">rect1</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">trans_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rect1</span><span class="p">)</span>

<span class="c1"># Translatable objects can also be copied &amp; translated in the same way.</span>
<span class="n">rect2</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">80</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">81</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">rect3</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">rect2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">trans_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rect2</span><span class="p">)</span>
<span class="n">trans_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rect3</span><span class="p">)</span>

<span class="c1"># Reference Cells are also translatable, and thus copyable.</span>
<span class="n">ref1</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">CellReference</span><span class="p">(</span><span class="n">poly_cell</span><span class="p">,</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>
<span class="n">ref2</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ref1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">trans_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ref1</span><span class="p">)</span>
<span class="n">trans_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ref2</span><span class="p">)</span>

<span class="c1"># Same goes for Labels &amp; Text</span>
<span class="n">text1</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
    <span class="s1">&#39;Created with gdspy &#39;</span> <span class="o">+</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">35</span><span class="p">),</span> <span class="n">layer</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">text2</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">)</span>
<span class="n">label1</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
    <span class="s1">&#39;Created with gdspy &#39;</span> <span class="o">+</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">36</span><span class="p">),</span> <span class="s1">&#39;nw&#39;</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">label2</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">label1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">)</span>
<span class="n">trans_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
<span class="n">trans_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">text2</span><span class="p">)</span>
<span class="n">trans_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">label1</span><span class="p">)</span>
<span class="n">trans_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">label2</span><span class="p">)</span>

<span class="c1"># ------------------------------------------------------------------ #</span>
<span class="c1">#      OUTPUT</span>
<span class="c1"># ------------------------------------------------------------------ #</span>

<span class="c1"># Output the layout to a GDSII file (default to all created cells).</span>
<span class="c1"># Set the units we used to micrometers and the precision to nanometers.</span>
<span class="n">gdspy</span><span class="o">.</span><span class="n">write_gds</span><span class="p">(</span><span class="s1">&#39;tutorial.gds&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mf">1.0e-9</span><span class="p">)</span>

<span class="c1"># ------------------------------------------------------------------ #</span>
<span class="c1">#      IMPORT</span>
<span class="c1"># ------------------------------------------------------------------ #</span>

<span class="c1"># Import the file we just created, and extract the cell &#39;POLYGONS&#39;. To</span>
<span class="c1"># avoid naming conflict, we will rename all cells.</span>
<span class="n">gdsii</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">GdsLibrary</span><span class="p">()</span>
<span class="n">gdsii</span><span class="o">.</span><span class="n">read_gds</span><span class="p">(</span>
    <span class="s1">&#39;tutorial.gds&#39;</span><span class="p">,</span>
    <span class="n">rename</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;POLYGONS&#39;</span><span class="p">:</span> <span class="s1">&#39;IMPORT_POLY&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PATHS&#39;</span><span class="p">:</span> <span class="s1">&#39;IMPORT_PATHS&#39;</span><span class="p">,</span>
        <span class="s1">&#39;OPERATIONS&#39;</span><span class="p">:</span> <span class="s1">&#39;IMPORT_OPER&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SLICE&#39;</span><span class="p">:</span> <span class="s1">&#39;IMPORT_SLICE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;REFS&#39;</span><span class="p">:</span> <span class="s1">&#39;IMPORT_REFS&#39;</span><span class="p">,</span>
        <span class="s1">&#39;TRANS&#39;</span><span class="p">:</span> <span class="s1">&#39;IMPORT_TRANS&#39;</span>
    <span class="p">},</span>
    <span class="n">layers</span><span class="o">=</span><span class="p">{</span>
        <span class="mi">1</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="mi">9</span>
    <span class="p">})</span>

<span class="c1"># Now we extract the cells we want to actually include in our current</span>
<span class="c1"># structure. Note that the referenced cells will be automatically</span>
<span class="c1"># extracted as well.</span>
<span class="n">gdsii</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s1">&#39;IMPORT_REFS&#39;</span><span class="p">)</span>

<span class="c1"># ------------------------------------------------------------------ #</span>
<span class="c1">#      VIEWER</span>
<span class="c1"># ------------------------------------------------------------------ #</span>

<span class="c1"># View the layout using a GUI.  Full description of the controls can</span>
<span class="c1"># be found in the online help at http://gdspy.sourceforge.net/</span>
<span class="n">gdspy</span><span class="o">.</span><span class="n">LayoutViewer</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="integrated-photonics">
<h2>Integrated Photonics<a class="headerlink" href="#integrated-photonics" title="Permalink to this headline">¶</a></h2>
<p>This example demonstrates the use of gdspy primitives to create more complex structures.</p>
<p>These structures are commonly used in the field of integrated photonics.</p>
<p><a class="reference download internal" download="" href="_downloads/0876941a9d27f4df779e91e6d70a797c/photonics.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">sample</span> <span class="pre">file</span></code></a></p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">######################################################################</span>
<span class="c1">#                                                                    #</span>
<span class="c1">#  Copyright 2009-2018 Lucas Heitzmann Gabrielli.                    #</span>
<span class="c1">#  This file is part of gdspy, distributed under the terms of the    #</span>
<span class="c1">#  Boost Software License - Version 1.0.  See the accompanying       #</span>
<span class="c1">#  LICENSE file or &lt;http://www.boost.org/LICENSE_1_0.txt&gt;            #</span>
<span class="c1">#                                                                    #</span>
<span class="c1">######################################################################</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">gdspy</span>


<span class="k">def</span> <span class="nf">waveguide</span><span class="p">(</span><span class="n">path</span><span class="p">,</span>
              <span class="n">points</span><span class="p">,</span>
              <span class="n">finish</span><span class="p">,</span>
              <span class="n">bend_radius</span><span class="p">,</span>
              <span class="n">number_of_points</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
              <span class="n">direction</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
              <span class="n">layer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
              <span class="n">datatype</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Easy waveguide creation tool with absolute positioning.</span>

<span class="sd">    path             : starting `gdspy.Path`</span>
<span class="sd">    points           : coordinates along which the waveguide will travel</span>
<span class="sd">    finish           : end point of the waveguide</span>
<span class="sd">    bend_radius      : radius of the turns in the waveguide</span>
<span class="sd">    number_of_points : same as in `path.turn`</span>
<span class="sd">    direction        : starting direction</span>
<span class="sd">    layer            : GDSII layer number</span>
<span class="sd">    datatype         : GDSII datatype number</span>

<span class="sd">    Return `path`.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">path</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">finish</span><span class="p">[(</span><span class="n">axis</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))</span> <span class="o">%</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="n">axis</span><span class="p">]:</span>
        <span class="n">path</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;+x&#39;</span><span class="p">,</span> <span class="s1">&#39;+y&#39;</span><span class="p">][</span><span class="n">axis</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">path</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-x&#39;</span><span class="p">,</span> <span class="s1">&#39;-y&#39;</span><span class="p">][</span><span class="n">axis</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">path</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
            <span class="nb">abs</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="n">axis</span><span class="p">])</span> <span class="o">-</span> <span class="n">bend_radius</span><span class="p">,</span>
            <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">axis</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">goto</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">goto</span> <span class="o">=</span> <span class="n">finish</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">goto</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="n">axis</span><span class="p">])</span> <span class="o">^</span> <span class="p">((</span><span class="n">path</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span> <span class="o">^</span>
                                              <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">)):</span>
            <span class="n">bend</span> <span class="o">=</span> <span class="s1">&#39;l&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bend</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
        <span class="n">path</span><span class="o">.</span><span class="n">turn</span><span class="p">(</span>
            <span class="n">bend_radius</span><span class="p">,</span>
            <span class="n">bend</span><span class="p">,</span>
            <span class="n">number_of_points</span><span class="o">=</span><span class="n">number_of_points</span><span class="p">,</span>
            <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
        <span class="nb">abs</span><span class="p">(</span><span class="n">finish</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="n">axis</span><span class="p">]),</span>
        <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
        <span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">taper</span><span class="p">(</span><span class="n">path</span><span class="p">,</span>
          <span class="n">length</span><span class="p">,</span>
          <span class="n">final_width</span><span class="p">,</span>
          <span class="n">final_distance</span><span class="p">,</span>
          <span class="n">direction</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
          <span class="n">layer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
          <span class="n">datatype</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Linear tapers for the lazy.</span>

<span class="sd">    path        : `gdspy.Path` to append the taper</span>
<span class="sd">    length      : total length</span>
<span class="sd">    final_width : final width of th taper</span>
<span class="sd">    direction   : taper direction</span>
<span class="sd">    layer       : GDSII layer number (int or list)</span>
<span class="sd">    datatype    : GDSII datatype number (int or list)</span>

<span class="sd">    Parameters `layer` and `datatype` must be of the same type. If they</span>
<span class="sd">    are lists, they must have the same length. Their length indicate the</span>
<span class="sd">    number of pieces that compose the taper.</span>

<span class="sd">    Return `path`.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">==</span> <span class="n">datatype</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">==</span> <span class="p">[]</span><span class="o">.</span><span class="vm">__class__</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">datatype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datatype</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer</span><span class="p">]</span>
        <span class="n">datatype</span> <span class="o">=</span> <span class="p">[</span><span class="n">datatype</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parameters layer and datatype must have the same &#39;</span>
                         <span class="s1">&#39;type (either int or list) and length.&#39;</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">path</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">final_width</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="n">final_distance</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">path</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
            <span class="n">l</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">path</span>


<span class="k">def</span> <span class="nf">grating</span><span class="p">(</span><span class="n">period</span><span class="p">,</span>
            <span class="n">number_of_teeth</span><span class="p">,</span>
            <span class="n">fill_frac</span><span class="p">,</span>
            <span class="n">width</span><span class="p">,</span>
            <span class="n">position</span><span class="p">,</span>
            <span class="n">direction</span><span class="p">,</span>
            <span class="n">lda</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">sin_theta</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">focus_distance</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">focus_width</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">evaluations</span><span class="o">=</span><span class="mi">99</span><span class="p">,</span>
            <span class="n">layer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">datatype</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Straight or focusing grating.</span>

<span class="sd">    period          : grating period</span>
<span class="sd">    number_of_teeth : number of teeth in the grating</span>
<span class="sd">    fill_frac       : filling fraction of the teeth (w.r.t. the period)</span>
<span class="sd">    width           : width of the grating</span>
<span class="sd">    position        : grating position (feed point)</span>
<span class="sd">    direction       : one of {&#39;+x&#39;, &#39;-x&#39;, &#39;+y&#39;, &#39;-y&#39;}</span>
<span class="sd">    lda             : free-space wavelength</span>
<span class="sd">    sin_theta       : sine of incidence angle</span>
<span class="sd">    focus_distance  : focus distance (negative for straight grating)</span>
<span class="sd">    focus_width     : if non-negative, the focusing area is included in</span>
<span class="sd">                      the result (usually for negative resists) and this</span>
<span class="sd">                      is the width of the waveguide connecting to the</span>
<span class="sd">                      grating</span>
<span class="sd">    evaluations     : number of evaluations of `path.parametric`</span>
<span class="sd">    layer           : GDSII layer number</span>
<span class="sd">    datatype        : GDSII datatype number</span>

<span class="sd">    Return `PolygonSet`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">focus_distance</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">L1Path</span><span class="p">(</span>
            <span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span>
             <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">number_of_teeth</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">fill_frac</span><span class="p">)</span> <span class="o">*</span> <span class="n">period</span><span class="p">),</span>
            <span class="s1">&#39;+x&#39;</span><span class="p">,</span>
            <span class="n">period</span> <span class="o">*</span> <span class="n">fill_frac</span><span class="p">,</span> <span class="p">[</span><span class="n">width</span><span class="p">],</span> <span class="p">[],</span>
            <span class="n">number_of_teeth</span><span class="p">,</span>
            <span class="n">period</span><span class="p">,</span>
            <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
            <span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">neff</span> <span class="o">=</span> <span class="n">lda</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">period</span><span class="p">)</span> <span class="o">+</span> <span class="n">sin_theta</span>
        <span class="n">qmin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">focus_distance</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">period</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">period</span> <span class="o">*</span> <span class="n">fill_frac</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
        <span class="n">max_points</span> <span class="o">=</span> <span class="mi">199</span> <span class="k">if</span> <span class="n">focus_width</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">evaluations</span>
        <span class="n">c3</span> <span class="o">=</span> <span class="n">neff</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">sin_theta</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">w</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">width</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">qmin</span><span class="p">,</span> <span class="n">qmin</span> <span class="o">+</span> <span class="n">number_of_teeth</span><span class="p">):</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">lda</span> <span class="o">*</span> <span class="n">sin_theta</span>
            <span class="n">c2</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">lda</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">path</span><span class="o">.</span><span class="n">parametric</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="n">w</span><span class="p">,</span> <span class="p">(</span><span class="n">c1</span> <span class="o">+</span> <span class="n">neff</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c2</span> <span class="o">-</span> <span class="n">c3</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">width</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">c3</span><span class="p">),</span>
                <span class="n">number_of_evaluations</span><span class="o">=</span><span class="n">evaluations</span><span class="p">,</span>
                <span class="n">max_points</span><span class="o">=</span><span class="n">max_points</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
                <span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>
            <span class="n">path</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">path</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">focus_width</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">polygons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">polygons</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="n">evaluations</span><span class="p">,</span> <span class="p">:],</span>
                 <span class="p">([</span><span class="n">position</span><span class="p">]</span> <span class="k">if</span> <span class="n">focus_width</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span>
                  <span class="p">[(</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">focus_width</span><span class="p">,</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                   <span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">focus_width</span><span class="p">,</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">])])))</span>
            <span class="n">path</span><span class="o">.</span><span class="n">fracture</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;-x&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;+x&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;-y&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">path</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># Examples</span>

    <span class="n">c1</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="s1">&#39;Example1&#39;</span><span class="p">)</span>
    <span class="c1"># Waveguide starts at (0, 0)...</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="mf">0.450</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># ... then starts in the +y direction up to y=200, then through x=500,</span>
    <span class="c1"># and stops at (800, 400). All bends have radius 50.</span>
    <span class="n">waveguide</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span> <span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span> <span class="mi">50</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;+y&#39;</span><span class="p">)</span>
    <span class="n">c1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="c1"># More useful example including a taper and a grating:</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="s1">&#39;Example2&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="mf">0.120</span><span class="p">,</span> <span class="p">(</span><span class="mi">50</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">taper</span><span class="p">(</span>
            <span class="n">path</span><span class="p">,</span>
            <span class="mi">75</span><span class="p">,</span>
            <span class="mf">0.450</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;+y&#39;</span><span class="p">,</span>
            <span class="n">layer</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
            <span class="n">datatype</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
        <span class="n">waveguide</span><span class="p">(</span>
            <span class="n">path</span><span class="p">,</span> <span class="p">[</span><span class="mi">300</span> <span class="o">-</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="mi">500</span> <span class="o">+</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="mi">425</span><span class="p">),</span> <span class="mi">50</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">c2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">c2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">grating</span><span class="p">(</span>
                <span class="mf">0.626</span><span class="p">,</span>
                <span class="mi">28</span><span class="p">,</span>
                <span class="mf">0.5</span><span class="p">,</span>
                <span class="mi">19</span><span class="p">,</span> <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
                <span class="n">path</span><span class="o">.</span><span class="n">direction</span><span class="p">,</span>
                <span class="mf">1.55</span><span class="p">,</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">/</span> <span class="mi">180</span><span class="p">),</span>
                <span class="mf">21.5</span><span class="p">,</span>
                <span class="mi">2</span> <span class="o">*</span> <span class="n">path</span><span class="o">.</span><span class="n">w</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">datatype</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Straight grating and positive resist example</span>
    <span class="n">c3</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="s1">&#39;Example3&#39;</span><span class="p">)</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;layer&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;datatype&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
    <span class="n">lda</span> <span class="o">=</span> <span class="mf">1.55</span>
    <span class="n">gr_width</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">gr_per</span> <span class="o">=</span> <span class="mf">0.626</span>
    <span class="n">gr_teeth</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">wg_clad</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">wg_width</span> <span class="o">=</span> <span class="mf">0.45</span>
    <span class="n">tp_len</span> <span class="o">=</span> <span class="mi">700</span>
    <span class="n">c3</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">grating</span><span class="p">(</span><span class="n">gr_per</span><span class="p">,</span> <span class="n">gr_teeth</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">gr_width</span><span class="p">,</span> <span class="p">(</span><span class="n">gr_per</span> <span class="o">*</span> <span class="n">gr_teeth</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;-x&#39;</span><span class="p">,</span>
                <span class="n">lda</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">/</span> <span class="mi">180</span><span class="p">),</span> <span class="o">**</span><span class="n">spec</span><span class="p">))</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">gdspy</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span>
        <span class="n">wg_clad</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">number_of_paths</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">gr_width</span> <span class="o">+</span> <span class="n">wg_clad</span><span class="p">)</span>
    <span class="n">path</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">gr_per</span> <span class="o">*</span> <span class="n">gr_teeth</span><span class="p">,</span> <span class="s1">&#39;+x&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">taper</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">tp_len</span><span class="p">,</span> <span class="n">wg_clad</span><span class="p">,</span> <span class="n">wg_width</span> <span class="o">+</span> <span class="n">wg_clad</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">waveguide</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="p">[</span><span class="mi">800</span><span class="p">],</span> <span class="p">(</span><span class="n">tp_len</span> <span class="o">+</span> <span class="n">gr_per</span> <span class="o">*</span> <span class="n">gr_teeth</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">taper</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">tp_len</span><span class="p">,</span> <span class="n">wg_clad</span><span class="p">,</span> <span class="n">gr_width</span> <span class="o">+</span> <span class="n">wg_clad</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">c3</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">grating</span><span class="p">(</span><span class="n">gr_per</span><span class="p">,</span> <span class="n">gr_teeth</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">gr_width</span><span class="p">,</span> <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
                <span class="n">path</span><span class="o">.</span><span class="n">direction</span><span class="p">,</span> <span class="n">lda</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">/</span> <span class="mi">180</span><span class="p">),</span> <span class="o">**</span><span class="n">spec</span><span class="p">))</span>
    <span class="n">path</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">gr_per</span> <span class="o">*</span> <span class="n">gr_teeth</span><span class="p">,</span> <span class="o">**</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">c3</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="n">gdspy</span><span class="o">.</span><span class="n">LayoutViewer</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="geometry.html" class="btn btn-neutral float-right" title="Geometry Construction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="gdspy’s Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2009-2018, Lucas H. Gabrielli

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>