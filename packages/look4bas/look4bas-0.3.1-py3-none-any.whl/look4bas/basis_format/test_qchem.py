from . import qchem
from ..testdata import get_json
import unittest
import re


# The reference result for the Si section of pc-2
# in Q-Chem format
reference_si = """
S   9  1.00
  120040.0000000    0.00016075000
   17991.0000000     0.0012472000
    4094.8000000     0.0065040000
    1159.6000000      0.026665000
     378.0000000      0.088816000
     135.9300000       0.22932000
      52.4110000       0.40025000
      20.9270000       0.33828000
       7.7130000      0.065512000
S   9  1.00
   17991.0000000   -6.8403000E-07
    4094.8000000   -2.1124000E-06
    1159.6000000   -6.9157000E-05
     378.0000000   -0.00048080000
     135.9300000    -0.0041694000
      52.4110000     -0.017674000
      20.9270000     -0.042891000
       7.7130000      0.045368000
       3.1604000       0.13904000
S   9  1.00
    4094.8000000   -3.9897000E-06
    1159.6000000   -5.0203000E-05
     378.0000000   -0.00057553000
     135.9300000    -0.0041524000
      52.4110000     -0.020437000
      20.9270000     -0.046998000
       7.7130000      0.043986000
       3.1604000       0.33957000
       1.2348000       0.35038000
S   1  1.00
       0.2677500        1.0000000
S   1  1.00
       0.0940670        1.0000000
P   7  1.00
     677.1300000     0.0010925000
     160.6700000     0.0089601000
      51.5850000      0.044744000
      18.9480000       0.14748000
       7.6163000       0.31480000
       3.1317000       0.41339000
       1.2703000       0.26440000
P   7  1.00
     160.6700000    7.9014000E-06
      51.5850000   -0.00013613000
      18.9480000   -0.00090378000
       7.6163000    -0.0055863000
       3.1317000     -0.010141000
       1.2703000      0.018661000
       0.4333200       0.28890000
P   1  1.00
       0.1608800        1.0000000
P   1  1.00
       0.0548830        1.0000000
D   1  1.00
       1.6800000        1.0000000
D   1  1.00
       0.3800000        1.0000000
F   1  1.00
       0.5400000        1.0000000
"""

# The reference result for the C section of pc-2
# in Q-Chem format
reference_c = """
S   7  1.00
    7857.1000000    0.00056825000
    1178.7000000     0.0043915000
     268.3200000      0.022504000
      75.9480000      0.086653000
      24.5590000       0.24405000
       8.6212000       0.44148000
       3.1278000       0.35332000
S   7  1.00
    1178.7000000   -5.9492000E-07
     268.3200000   -6.2748000E-05
      75.9480000   -0.00075773000
      24.5590000    -0.0073308000
       8.6212000     -0.038932000
       3.1278000     -0.088908000
       0.8220200       0.21689000
S   1  1.00
       0.3301700        1.0000000
S   1  1.00
       0.1146300        1.0000000
P   4  1.00
      33.7750000     0.0060294000
       7.6766000      0.043228000
       2.2357000       0.16301000
       0.7644700       0.36504000
P   1  1.00
       0.2623200        1.0000000
P   1  1.00
       0.0846380        1.0000000
D   1  1.00
       1.4000000        1.0000000
D   1  1.00
       0.4500000        1.0000000
F   1  1.00
       0.9500000        1.0000000
"""


class TestQChem(unittest.TestCase):
    """
    Test dumping Q-Chem basis section
    """
    def test_dumps(self):
        data = get_json("pc-2")
        dump = qchem.dumps(data)

        lines = dump.split("\n")
        assert lines[0] == "$basis"
        assert lines[-1] == "$end"

        # Silicon
        re_si = re.compile(r"\*\*\*\*\nSi  0([^*]*)\*\*\*\*",
                           re.MULTILINE + re.DOTALL)
        part_si = re.search(re_si, dump)
        assert part_si
        assert reference_si.strip() == part_si.group(1).strip()

        # Carbon
        re_c = re.compile(r"\*\*\*\*\n C  0([^*]*)\*\*\*\*",
                          re.MULTILINE + re.DOTALL)
        part_c = re.search(re_c, dump)
        assert part_c
        assert reference_c.strip() == part_c.group(1).strip()
